<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <!-- íŒŒë¹„ì½˜ -->

    <style>
      /* ë¡œë”©ì¤‘ í‘œê¸°ì°½ */

      body {
        position: relative;
        /* ìŠ¤í¬ë¡¤ë°” ë§‰ê¸° */
        overflow: auto;
      }

      #loading {
        position: fixed;
        top: 0;
        right: 0;
        left: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        /* ë¡œë”©ìŠ¤í”¼ë„ˆë¥¼ ê°€ìš´ë° ì •ë ¬í•˜ê¸° ìœ„í•´ flex */
        display: none;
        /* ê°€ë¡œì •ë ¬ */
        justify-content: center;
        /* ì„¸ë¡œì •ë ¬ */
        align-items: center;
      }
      /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
      #loading .loader {
        width: 50px;
        height: 50px;
        display: inline-block;
        border: 5px solid #fff;
        border-radius: 50%;
        border-bottom-color: red;
        animation: rotation 1s linear infinite;
      }
      /* ê²€ìƒ‰ì°½ */
      #search {
        position: fixed;
        display: inline-block;
        width: 98%;
        text-align: center;
        top: 0;
        border: solid 1px red;
      }
      /* íƒ€ì´í‹€ í´ë¦­ì‹œ ë™ì‘ */
      #newSearch {
        display: none;
        background-color: #fff;
        border: 1px solid black;
        width: 500px;
        height: 600px;
        position: absolute;
        top: 70px;
        left: 50%;
        transform: translate(-50%, 0);
        overflow: auto;
      }
      /* íƒ€ì´í‹€ í´ë¦­ ìƒˆì°½ */
      #newbtn {
        position: absolute;
        right: 20px;
        top: 20px;
      }

      #data {
        position: relative;
      }

      /* ìŠ¤í”¼ë„ˆ ëŒì•„ê°€ëŠ” ì• ë‹ˆë§¤ì´ì…˜ ìƒì„± */
      @keyframes rotation {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <!-- ë¡œë”©ì¤‘ í‘œê¸° -->
    <div id="loading">
      <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ (ë™ê¸°í™”ì¤‘í‘œì‹œ) -->
      <span class="loader"></span>
    </div>
    <!-- json dataë¥¼ ë‹´ì„ ul ìƒì„± -->
    <div>
      <ul id="data">
        Post
      </ul>
      <!-- íƒ€ì´í‹€ í´ë¦­ì‹œ ë™ì‘ -->
      <div>
        <button type="button" id="newbtn">ë‹«ê¸°</button>
        <div id="newSearch"></div>
      </div>
    </div>
    <!-- ì œì´ìŠ¨ ê°’ ê²€ìƒ‰ì°½ -->
    <div id="search">
      <label for="">ê²€ìƒ‰</label>
      <input type="text" id="text" />
      <button type="button" id="btn">ê²€ìƒ‰</button>
    </div>
    <script>
      // ë¡œë”©ì´ ì™„ë£Œë˜ë©´ ë¡œë”©ìŠ¤í”¼ë„ˆ ê°ì¶”ê¸° show
      const loading = document.querySelector("#loading");
      function toggleSpinner(show) {
        if (show) {
          loading.style.display = "none";
        } else {
          loading.style.display = "flex";
        }
      }
      /**
       * promise : ë­”ê°€ ìš”ì²­ì„í•˜ê³  ì„±ê³µ, ì‹¤íŒ¨ ë‘˜ì¤‘ í•˜ë‚˜ë§Œ ë°›ëŠ”ë‹¤.
       * ë¹„ë™ê¸° í†µì‹ ì‹œ ì‚¬ìš©í•œë‹¤.
       * fecth(url ê²½ë¡œ ê°’)
       * fecth(ê²½ë¡œ)
       * .than((íŒŒë¼ë¯¸í„°) => ì½”ë“œ1).than((íŒŒë¼ë¯¸í„°) => ì½”ë“œ2)
       * .catch((ì—ëŸ¬) => ì—ëŸ¬ì²˜ë¦¬).finally(() => í• ì¼)
       */
      // ê²€ìƒ‰ë²„íŠ¼ ì…ë ¥ì‹œ ë™ì‘
      const btn = document.querySelector("#btn");
      btn.addEventListener("click", (e) => {
        const text = document.querySelector("#text").value;
        const displayNone = document.querySelector("#data");
        console.log(text);
        getPostList(text);
      });

      // íƒ€ì´í‹€ë²„íŠ¼ ì…ë ¥ì‹œ ë™ì‘
      function showInfo(id) {
        const dataContainer = document.querySelector("#newSearch");
        document.querySelector("body").style.overflow = "hidden";
        dataContainer.innerHTML = ``;
        dataContainer.style.display = "block";
        fetch(`https://jsonplaceholder.typicode.com/posts/${id}`)
          .then((response) => response.json())
          .then((data) => {
            dataContainer.innerHTML += `
            <h2>ë³¸ë¬¸</h2>
            <h3>title: ${data.title}</h3>
            <p>body: ${data.body}</p>
            <p>id : ${data.id}</p>
            <h2>ëŒ“ê¸€</h2>
            `;
          });
        fetch(`https://jsonplaceholder.typicode.com/posts/${id}/comments`)
          .then((response) => response.json())
          .then((data) => {
            data.forEach((post) => {
              dataContainer.innerHTML += `
            <h3>name: ${post.name}</h3>
            <p>email: ${post.email}</p>
            <p>body: ${post.body}</p>`;
            });
          });
      }
      // íƒ€ì´í‹€ ì…ë ¥ì‹œ ìƒˆì°½ ë‹«ê¸° ë²„íŠ¼
      document.querySelector("#newbtn").addEventListener("click", (e) => {
        e.preventDefault();
        const dataContainer = document.querySelector("#newSearch");
        dataContainer.style.display = "none";
        document.querySelector("body").style.overflow = "auto";
      });
      // keywordëŠ” ê°’ì´ ìˆìœ¼ë©´ ê²€ìƒ‰ê°’ ì¶œë ¥
      function getPostList(keyword) {
        // ë¡œë”©ì¤‘ ìŠ¤í”¼ë„ˆ í‘œê¸°
        toggleSpinner(false);
        fetch("https://jsonplaceholder.typicode.com/posts")
          .then((response) => response.json()) // ğŸ‘‰ ë³¸ë¬¸ì„ JSONìœ¼ë¡œ ë³€í™˜
          .then((data) => {
            // ìœ„ì—ì„œ ìƒì„±í•œí•œ í´ë ˆìŠ¤ í˜¸ì¶œ
            const dataContainer = document.querySelector("#data");
            dataContainer.innerHTML = "";

            /**
             * keyword ? ... : ...	ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ â†’ í•„í„°ë§, ì—†ìœ¼ë©´ â†’ ì „ì²´ ì¶œë ¥
             * data.filter(...)	ì „ì²´ ë°ì´í„°(data) ì¤‘ì—ì„œ ì¡°ê±´ì— ë§ëŠ” ê²ƒë§Œ ê³¨ë¼ë‚¸ë‹¤
             * `(post) => post.title.includes(keyword) */
            const filterData = keyword
              ? data.filter(
                  (post) =>
                    post.title.includes(keyword) || post.body.includes(keyword)
                )
              : data;

            // jsonìœ¼ë¡œ ë³€í™˜ëœ ë°ì´í„°ë¥¼ ë°˜ë³µë¬¸ìœ¼ë¡œ ëŒì•„ liì— ê°’ëŒ€ì…
            filterData.forEach((post) => {
              const json = document.createElement("li");
              json.innerHTML = `
            <button type="button" onclick="showInfo(${post.id})">title : ${post.title}</button>
            <p>body : ${post.body}</p>
            <p>id : ${post.id}, userid : ${post.userId}</p>`;
              dataContainer.appendChild(json);
            });
          })
          .catch((error) => console.error(error.message))
          // ë¡œë”©ì™„ë£Œì‹œ ìŠ¤í”¼ë„ˆí‘œê¸° none
          .finally(() => toggleSpinner(true));
      }

      getPostList();

      fetch("https://jsonplaceholder.typicode.com/posts")
        .then((response) => response.json()) // ğŸ‘‰ ë³¸ë¬¸ì„ JSONìœ¼ë¡œ ë³€í™˜
        .then((data) => console.log(data)) // ğŸ‘‰ ë³€í™˜ëœ ë°ì´í„°ë¥¼ ì¶œë ¥
        .catch((error) => console.error(error.message)); // ğŸ‘‰ ì—ëŸ¬ ì²˜ë¦¬
    </script>
  </body>
</html>

<!-- if (keyword.length) { const key = json.filter( (i) => i.title === key || i.body ===
key ); json.innerHTML = `
<h2>title : ${post.title}</h2>
<p>body : ${post.body}</p>
<p>id : ${post.id}, userid : ${post.userId}</p>
`; dataContainer.appendChild(json); } else -->
